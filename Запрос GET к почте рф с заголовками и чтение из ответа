&НаКлиенте
Процедура ТекущиеНастройкиПользователя(Команда)
	ТекущиеНастройкиПользователяНаСервере();
КонецПроцедуры

&НаСервере
Процедура ТекущиеНастройкиПользователяНаСервере() Экспорт	
	token =  "du3SSkj0_MrKHMhynFBk1oAlCgx6m2tG"; // бит_ИнтеграцияПочтаРФ.ПолучитьТокенИлиКлюч("токен");
	Logkey = "dm5ib2V2a2luQDFjYml0LnJ1OnFhenFhejE"; //бит_ИнтеграцияПочтаРФ.ПолучитьТокенИлиКлюч("ключ");
	
	Сервер = "otpravka-api.pochta.ru";      
	Ресурс = "/1.0/settings";
	
	HTTPЗапрос = Новый HTTPЗапрос;
		
	HTTPЗапрос.АдресРесурса = Ресурс;
	
	ssl = Новый ЗащищенноеСоединениеOpenSSL;
	
	HTTP = Новый HTTPСоединение(Сервер,,,,,,ssl);   
	
	HTTPЗапрос.Заголовки.Вставить("Content-Type", "application/json;charset=UTF-8");
	HTTPЗапрос.Заголовки.Вставить("Authorization", "AccessToken " + token);
	HTTPЗапрос.Заголовки.Вставить("X-User-Authorization", "Basic " + Logkey);
	
	Попытка
		СчетчикПопыток = 1;
		Пока СчетчикПопыток < 20 Цикл
			Попытка
				//ОтветHTTP = HTTP.ОтправитьДляОбработки(HTTPЗапрос, "с:\Users\AlASmolin\Desktop\JSON\streamWrite.json");
				ОтветHTTP = HTTP.Получить(HTTPЗапрос);
				Сообщить(ОтветHTTP.ПолучитьТелоКакСтроку("UTF-8"));
				Прервать;
			Исключение
				Сообщить("Попытка получения ответа: " + СчетчикПопыток);
				СчетчикПопыток  = СчетчикПопыток + 1;
			КонецПопытки;	
		КонецЦикла;		
	Исключение
		СтрокаСообщения = ОписаниеОшибки();
		Сообщить(СтрокаСообщения, СтатусСообщения.Важное);
		Возврат;
	КонецПопытки;

КонецПроцедуры

